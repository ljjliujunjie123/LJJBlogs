> 参考书籍 《人人可懂的密码学 第二版》作者 Keith M. Martin
>
> 本文持续更新，摘取书中对初级程序员有机会接触到的密码学部分知识

## 密码学基础概念

密码学原语：密码学整体是一个提供安全服务的工具包，其中包含很多工具，每一个工具被称为一个密码学原语。包括分组密码、流密码、消息认证码、哈希函数、数字签名方案

密码算法：是一些列计算步骤的集合，规定了一个算法思想，程序员可以用任意语言任意思路去实现它

密码协议：多方进行一系列消息交换和操作这一过程，过程结束后应该已经实现了一系列安全目标。最典型的就是`https`的三次握手过程

密码系统：泛指一些密码原语及相关基础设施的实现

<img src="E:\ljj的博客\pictures source\星愿浏览器截图20211019162452@2x.png" style="zoom:33%;" />

明文：从发送方到接收方的传输过程中需要保护的原始数据，明文的传输信道需要保护

密文：用加密算法和加密密钥作用于明文，生成的加密版明文。密文的传输不需要保护

加密算法：给定任意明文和加密密钥条件下，用来生成密文的一系列计算规则

> 加密算法本身并不保密，甚至很多论文都公开各种加密算法的原理。但加密算法的`nb`之处在于没有解密密钥，暴力根本无法逆向求解，暴力运算时间都能突破百年。如果你能不用密钥逆向求解出来，那还偷个锤子的信息，国安局需要你！

解密算法：给定任意密文和加密密钥条件下，用来恢复唯一明文的一系列计算规则

加密密钥：发送方知道，用于和明文一起输入加密算法。接收方通常也知道。监听方可能知道也可能不知道

解密密钥：接收方知道，用于和密文一起输入解密算法。解密密钥和加密密钥有关系，比如是互为映射，但并不一定相同。**监听方必须不能知道**

> 一般我们说私钥要保护好，其实保护的就是解密密钥

监听方：粗略可以理解为黑客，试图窃取信息。监听方能拿到全部的传输的密文，也能拿到加密算法和加密密钥。

> 两点强调：
>
> 加密并不能防止窃听，但是它能保证黑客看到的密文是无法被理解的数据
>
> 信道的加密并不能保证端到端的机密性。因为在发送方和接收方本地，信息可以且一般都是明文保存的，这时候有可能被窃取。而在这些端上用来保护信息的机制一般是访问控制，比如最常见的管理员权限

对称密码系统：加密密钥和解密密钥本质上是相同的，即便它们在数值上不完全相同。

公钥密码系统或非对称密码系统：加密密钥和解密密钥本质上完全不同，从加密密钥推断解密密钥是完全不可能的

> 这里的不可能是 “计算上的不可能”，也就是前面说的暴力需要上百年的那种
>
> 公钥密码系统的核心是数学，且其算法要比对称密码系统的少得多

对称密钥：因为对称密码系统中的加密密钥和解密密钥本质上是相同的，且很多时候是完全相同的，所以本质上这个系统只有一个密钥，所以一般简称**密钥**。这个情况下密钥就不能被监听方获取到

公钥与私钥：非对称密码系统中，仅需要保证解密密钥是保密的即可，所以加密密钥可以公开，因此叫作**公钥**，解密密钥是私密的，所以叫作**私钥**

> 有个简单的例子帮助理解这件事
>
> 寝室有四个人住，每人都有一把钥匙，每人也都可以使用这把钥匙进行关门和开门。那这个过程中，钥匙就是对称密钥
>
> 手机锁屏这个功能，任何拿到手机的人都能锁屏，但是只有手机主人才能打开屏幕。这个过程中，加密的过程是锁屏，需要的公钥是空（或者说是你的手，所有人都有），解密的过程是开机，需要的私钥是手机主人

`Kerckhoffs`第二原则：加密算法的安全性应该依赖解密密钥，而不是算法细节。即便算法的全部细节公开，任何人也不能逆向破解它

密钥长度和密钥空间：解密密钥的可能数量称为密钥空间大小。一般而言密钥空间大小是密钥位数k的2指数次方

> 作为程序员接触最多的密钥可能是`Github`认证时的私钥上传。大概是100多位吧

## 对称密码系统

对称密码算法的基本思想是，将一个二进制的序列串映射到另一个二进制的序列。

对称密码算法分为两大类

- 流密码：按位处理明文，即读入一位明文，输出一位密文
- 分组密码：将明文分成多个块，每读入一块明文，输出一块密文

#### 流密码

流密码的密钥一般远小于明文长度，比如128位

流密码的核心是密钥流生成器，它的输入是密钥，输出是和明文等长度的密钥流，这个密钥流是用数学算法计算出的一个伪随机数流

密钥流与明文进行一定的逻辑运算生成密文（比如异或运算）

使用流密码时，接收者需要持有相同的密钥和密钥流生成器

<img src="..\pictures source\微信图片_20211105130700.jpg" style="zoom: 25%;" />

流密码的特点

- 没有错误传播。因为流密码的编码是按位的，所以一位错误只会影响一位明文，不会传播
- 快速。计算过程简单
- 动态加密。比如安全键盘，每按下一位，立刻对该明文加密，避免存储大块的明文
- 实现效率。一些运算过程可以做到硬件支持，速度更快

流密码的例子：`RC4、A5/1、E0`

#### 分组密码

分组密码算法按照 **分组长度** 将明文分成若干块，称为明文分组，将整个明文分组和密钥共同输入加密算法，输出密文分组，密文分组的每一块长度等于分组长度

分组长度比较关键，太短保密能力不够，太长计算效率太低。一般是8的整数倍，比如`DES`的64位和`AES`的128位

分组密码的特点

- 错误传播
- 需要填充。明文长度一般都不是分组长度的整数倍，所以还需要设计一套填重方案

两种应用最广的分组密码算法

DES

DES是`Feistel`密码方案的一个实现，其基本思想如下

- 假设有一个64位明文，先拆分成左32位`L0`，右32位`R0`
- 将密钥K和`R0`，输入给**轮函数** `f(R0,K)`
- 将结果与`L0`异或得到32位新序列X
- 令新的右32位`R1`=X，新的左32位`L1=R0`
- 上述3步骤称为一轮，重复n轮后，将`Ln`与Rn拼接起来就是密文

DES分组长度64位，密钥长度64位，轮数是16轮

DES密钥的特点

- 加密和解密的步骤几乎完全相同，所以实现起来可以用同一套软硬件
- 轮数越多，安全性越强，扩展性强
- 每轮使用的密钥并不是原始密钥K，而是由K派生的子密钥`K0 K1 Kn`

由于DES密钥长度和轮数都太小，存在被穷举的可能，所以开发出了魔改版 **三重DES** 流程如下

<img src="..\pictures source\微信图片_20211105133916.jpg" style="zoom: 25%;" />

如果`K1=K3`被称为两密钥三重DES，反之三密钥三重DES

三重DES虽然安全性极大提高，但速度慢，如非必要，应使用下面的`AES`替代它

`AES`

这是`NIST`设计的一个标准，规定分组长度128位，密钥长度有128位、192位、256位三种可选，且运算速度必须快于三重DES。最终`NIST`选用了算法`Rijndael`作为该标准的实现

`AES`的最小运算单位是字节，而不是位。它的细节可查阅 https://blog.csdn.net/qq_28205153/article/details/55798628

`AES`是目前广泛使用的对称加密算法之一

#### 操作模式

> 一些参考
>
> https://www.cnblogs.com/baihuitestsoftware/articles/7090134.html
>
> https://www.sohu.com/a/278722262_100245441

即便是同一个密钥，使用同一个算法，如果我们对密钥的处理做一些微小的调整，输出结果也大不相同。这些调整被称为不同的操作模式（操作模式很多，这里只是四种）

- `ECB`模式：最简单直接的模式，用密钥逐个加密明文分组，产生对应的密文分组
- `CBC`模式：每个密文分组在发送给接收方时，同时作为下一个密文分组加密过程的输入
- `CFB`模式：密文反馈模式
- `CTR`模式：发送端与接收端共同维护一个计数器，加密和解密时都要依赖当前计数器的值

## 非对称密码系统

## 哈希函数与MAC

## 数字签名

## *实体身份验证

## 密码协议

## 密钥管理

## 因特网中的密码学