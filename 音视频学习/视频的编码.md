## 视频的编码

### 数字图像概念

##### 人眼视觉模型

人眼感光流程是光线透过晶状体被弯折，弯折程度由睫状肌控制，然后透过玻璃体落在视网膜上，刺激视网膜上的视感知细胞产生神经冲动，于大脑视觉中枢中形成视觉

视感知细胞分为视锥细胞，视杆细胞。前者能区分光的强度和色彩，在明亮环境下敏感，称为亮视觉，后者只能区分光的强度，在低照度环境下敏感，称为暗视觉

在相同光度下，人眼对波长555 nm的黄绿光最敏感。进一步细分会发现，视锥细胞可分为红敏细胞、绿敏细胞、蓝敏细胞，其最敏感的波长的光对应红绿蓝三色。这就是**三基色理论**

**对比效应**：人眼分辨力有限，当不同色度、亮度、面积的图像并存时，视觉上会有扭曲感

- 相同的两个红色色块分别放在红色背景，和蓝色背景下，前者的红色会感觉像橘色，后者的感觉像紫色
- 相同的两个彩色色块分别放在灰色背景，和相同彩色背景下，前者的饱和度感觉更弱
- 相同色度和亮度的两个区域，面积越大，人眼感觉亮度和饱和度越强

**马赫带效应**：相邻神经元的互相抑制现象。一个梯度变化的色带，在变化分界处感觉更暗

![img](https://pic1.zhimg.com/80/v2-dd31b2d7e50e5a6ecab13b2a89c719ff_1440w.jpg?source=1940ef5c)

**视觉暂留**：人眼对图像的感觉，在图像消失后呈指数式衰退，但不是立即消失。所以理论上离散图像的变化频率超过24 Hz后，视觉上就形成连续感

**人眼的彩色分辨力**：人眼对颜色的区分能力远差于对亮度的分辨

![微信图片_20211016093002](E:\ljj的博客\pictures source\微信图片_20211016093002.jpg)

**人眼的视野**：最佳视野范围约左右上下各15°，头部眼球都固定时的最大视野约左右35°和上下40°

##### 色彩与像素

一般的不会发光的物体，其颜色取决于其对环境光的吸收和反射

三基色理论用不同比例的红绿蓝色混合，可生成人眼能感知的所有颜色。基于这个理论的色彩模型是最常用的`RGB`模型，但色彩模型不仅这一个

**`RGB`模型**

<img src="E:\ljj的博客\pictures source\微信图片_20211016093028.jpg" alt="微信图片_20211016093028" style="zoom: 15%;" />

**`CMYK`模型**

印刷使用的模型。因为印刷出的字符的颜色，取决于入射光从颜料上的反射光，所以需要用`RGB`的反向色来打印。比如想打印红色字体，这里的红色是指人眼感觉它的红的，也就意味着它的反射光只有红色。一般入射光都是白色，所以说明这个颜料能吸收白色中除了红色的部分。根据三基色理论，白光可以近似看成红+蓝+绿，所以这个颜料需要能吸收蓝+绿光。能吸收蓝光的颜料，人眼看它的感觉应该是蓝色的补色，也就是白色 - 蓝色 = 黄色，同理白色 - 绿色 = 紫红色。所以用黄色颜料和紫红色颜料混合打印，字体就看起来是红色的 

C：绿+蓝=青，M：红+蓝=紫红，Y：绿+红=黄。为了打印的方便，认为加入K代表黑色。 

**`YUV`模型**

利用人眼对亮度和色彩的分辨力不同，把一个像素的颜色拆成亮度分量Y和色彩分量UV，后者采样率可以适当降低，人眼无法察觉。可参考https://zhuanlan.zhihu.com/p/75735751

![img](https://pic3.zhimg.com/80/v2-7cb7c3b35a16cf92039f455e3eb88582_1440w.jpg)

对`YUV`进行缩放和偏移即可得到视频编码标准中常用的模型 `YCbCr`。可参考https://blog.csdn.net/ericbar/article/details/80504801

**`HSI`模型**

将人眼对彩色的感觉分为色调H，饱和度S，亮度I，从这三个分量来定义颜色

最外层是纯色，两端是黑白色，角度代表色调，0-360对应不同的颜色

<img src="E:\ljj的博客\pictures source\微信图片_20211016093034.jpg" alt="微信图片_20211016093034" style="zoom:13%;" />

与`RGB`转换公式

![img](https://img.jbzj.com/file_images/article/201911/20191127100210.jpg)

**像素**

狭义的像素是光的模拟量通过采样和量化，变成数字量后的表达形式。所以旧式的胶片是没有像素概念的

采样的原理是奈奎斯特采样定理，量化则分为标量量化和矢量量化

### 图像变换理论

无论是什么图像变换，都是一个集合向另一个集合的映射，信息是不变的，变化的是信息的表现形式。在不同的形式下，做一些特定事情会更方便。而在视频编码中最常做的，就是在尽可能保证人眼对一幅图像的感觉是完整清晰的前提下，尽可能多地删减信息，以降低信息传输码率

##### 傅里叶变换

空间域向频域的映射

`f(t,z)`是两个连续变量t和z的连续函数，其二维连续傅里叶变换和逆变换定义如下
$$
F(u,v) = \int_{-\infin}^{\infin}\int_{-\infin}^{\infin}f(t,z)e^{-j2\pi(ut+vz)}dtdz
$$

$$
f(t,z)=\int_{-\infin}^{\infin}\int_{-\infin}^{\infin}F(u,v)e^{j2\pi(ut+vz)}dudv
$$

对其进行离散化，得到离散的二维傅里叶变换和逆变换

`f(x,y)`是大小M x N的数字图像，u = 0，1，2 ...... M-1，v = 0，1，2 ...... N-1
$$
F(u,v)=\sum_{x=0}^{M-1}\sum_{y=0}^{N-1}f(x,y)e^{-j2\pi(\frac{ux}{M}+\frac{vy}{N})}
$$

$$
f(x,y)=\frac1{MN}\sum_{u=0}^{M-1}\sum_{v=0}^{N-1}F(u,v)e^{j2\pi(\frac{ux}{M}+\frac{vy}{N})}
$$

频域中傅里叶变换系数，大致分为低频系数和高频系数。一张图像变化越剧烈，比如充斥着纹理，高频系数的幅值越大。相反，图像越平滑，低频系数幅值越大。

傅里叶变换的一些数学运算性质如下

![微信图片_20211016093043](E:\ljj的博客\pictures source\微信图片_20211016093043.jpg)

##### 余弦变换/`DCT`变换

傅里叶变换需要进行复数运算，不利于计算机处理，所以余弦变换是其替代品，因为它只需要实数运算

`f(x,y)`是大小M x N的数字图像，x,u = 0，1，2 ...... M-1，y,v = 0，1，2 ...... N-1
$$
F(u,v)=\frac2{MN}C(u)C(v)\sum_{x=0}^{M-1}\sum_{y=0}^{N-1}f(x,y)cos\frac{(2x+1)u\pi}{2M}cos\frac{(2y+1)v\pi}{2N}
$$

$$
C(u) = \{_{1,\space\space\space 其他}^{\frac1{\sqrt 2},\space\space\space u=0}
$$

$$
f(x,y)=\frac2{MN}C(u)C(v)\sum_{u=0}^{M-1}\sum_{v=0}^{N-1}F(u,v)cos\frac{(2x+1)u\pi}{2M}cos\frac{(2y+1)v\pi}{2N}
$$

根据高数和线代的基本知识，上述两个变换具有共同的变换核，可以定义为函数`g(u,v,x,y)`
$$
g(u,v,x,y) = \sqrt{\frac2M}C(u)cos\frac{(2x+1)u\pi}{2M}\sqrt{\frac2N}C(v)cos\frac{(2y+1)v\pi}{2N}
$$
当M = N时，g(u,x)等于g(v,y)。可以定义一个`MxN`的矩阵G表示各个变换系数。则余弦变换的矩阵形式为。矩阵的运算在计算机中非常方便
$$
F = GfG^T
$$

$$
f = GFG^T
$$

再次观察变换核函数g，当固定u,v时，会发现g函数图像是一个`MxN`的图像，可以称这个图为基图像。那么遍历u,v，可以得到一系列基图像。**那么二维离散的余弦变换可以看成，将一幅图像分解称一系列基图像，余弦变换系数是各个权重**。

下图是M = N = 8时的基图像组。

<img src="E:\ljj的博客\pictures source\微信图片_20211016093049.jpg" alt="微信图片_20211016093049" style="zoom:33%;" />

##### 沃尔什-哈达玛变换

这是一个运算速度比余弦变换更快的变换。其理论基础是哈达玛矩阵

一个`NxN`的哈达玛矩阵H满足
$$
HH^T=NI
$$

通过一些线代变换，可以得到只包含 +1 和 -1 元素的任意阶哈达玛矩阵。利用这种矩阵与图像进行正交变换时，由于只有加减法，所以自然运算速度快。

##### K-L变换

前面三种变换都是正交变换，核心思想都是线代的空间映射。`K-L`变换又叫作霍特林变换，是基于统计特性的变换

将一个`NxN`的图像矩阵，每一行/列看成一个向量，再把它们放在一起，堪称一个向量 x 的N个取值。那么该向量 x 就可以看作一个随机变量。定义其数学期望和协方差矩阵为
$$
E(x) = \frac1K\sum_{k=1}^Kx_k
$$

$$
C_x = E{((x-E(x))(x-E(x))^T)}=\frac1K\sum_{k=1}^Kx_kx_k^T-E(x)E(x)^T
$$

矩阵`Cx`是一个实对称矩阵，主对角元素表示各个x分量的能量大小，其他元素表示各个分量间的相关性

线代告诉我们，一个N阶实对称矩阵总可以找到一组N个正交的特征向量和特征值。矩阵C是N平方阶，所以有N方个特征向量和特征值。设为`e`和`λ`，并假设特征值从大到小排序。把所有`e`向量作为行向量，排成一个矩阵A，则A的行与行之间是正交的。

我们把A当作一个正交变换矩阵，则`K-L`变换和逆变换
$$
y = A(x-E(x))
$$

$$
x = A^Ty +E(x)
$$

其中进行逆变换时，如果不使用全部的特征向量，只选择特征值最大的前几个，同样能重构出完整的`NxN`图像。可以证明，这幅图像与原图的均方误差是剩余的特征值的和。这样就实现了编码的压缩

##### 小波变换

这部分还没看懂，想了解参考

https://www.cnblogs.com/jfdwd/p/9249850.html

https://www.zhihu.com/question/22864189

### 图像编码理论及协议

##### 熵编码

##### 变换编码

##### 预测编码

##### 矢量量化编码

##### `JPEG 2000`编码

### 视频编码理论及协议

##### 基于波形的编码

##### 基于内容的编码

##### `H.26X`与`MPEG-X`编码

##### `H.265/HEVC`编码

https://blog.csdn.net/xiaojun111111/article/details/61199130

### 图像及视频的传输理论

##### 传输模型

##### 码率控制

##### 差错控制

### 流媒体