### 正则表达式系列 一

本文是本系列第一部分，后续预计还有3-5篇

#### 学习初衷

如果说设计模式是内功修炼的无上心法，那么正则就是外功横练的不二法门。

最早听到正则这个词是大二时观摩别人的爬虫代码里，对那么一串花里胡哨的字符串惊为天人。再之后多次遇到使用的机会，却苦于不会遗憾收场（有好几次被妹子请教，然后不会...）

有很多大佬程序员不屑于正则，随口就是说，“正则不是30分钟随便看看就会了吗？！”，每次听到都对我脆弱的心灵造成难言的伤害。虽然正则确实比不上大雅之堂的深邃知识，但却是难倒英雄汉的那一分钱。

所以开个正则系列，冲冲冲~

#### 写给小白的基础介绍

定义：正则表达式是一组由字母和符号组成的特殊文本，它可以用来从文本中找出满足你想要的格式的句子

对于编码来说，正则表达式就是个字符串，只是构建这个字符串时需要使用特定的“单词”，遵循一定的“语法”。之后由各个编程语言的核心库函数去解析这个字符串，（如python中的re.search，java中的str.match）

根据解析结果获得一个筛选条件，拿着这个条件去待匹配文本中，挨个字符去判断（这里只是表述个意思，真实的匹配过程不一定这样）。如果在文本中找到了一个子串符合条件，就返回true，反之返回false/None

```python
#python
import re
#search函数第一个参数是正则表达式，第二个是待匹配文本
re.search("^[a-z0-9_]{3,15}$","ljjliujunjie123")
```

上面这行代码中，^   [  ]  - , {  }  $ ，这些字符就是正则表达式中的单词，且这些单词都有一定的特殊含义，就像英语中的to/for/as这些介词一样，没有太明确的意思，但是可以和普通单词构成短语。而a  z  0  9 _ 3 15这些就是普通的单词，表达的就是字面意思，依次是字母a,z，数字0,9，下划线，数字3和15。这些单词组合起来的这句正则，意思就是"**判断文本是不是由a到z这26个字母，和0到9这10个数字，以及下划线，组成的长度在3到15闭区间范围的一个字符串**"

#### 字符组

字符组是正则中最基本的结构之一，表示“在同一个位置可能出现的各种字符”，写法如[13579aeiou]这样，一个中括号中罗列一堆普通字符，表示在当前位置可能出现数字13579或者字母aeiou这10个字符中的其中一个。

试想如果直接用if语句判断上面这个例子，是不是至少写10个if(char == xxx)，这种代码搞出来肯定会被同事群嘲的啊~

###### 字符组的性质

- 字符组中的字符没有顺序。[abc] <=> [cba]。字符组中的字符可以重复，[aaa] <=> [a]。**但任何一个合格的coder都不应该写出反直觉的代码**。所以不要写乱序的字符组，也不要写重复的字符组。
- 字符组可以使用连接符-表示范围。[a-c] <=> [abc]。其原理是ASCII的码值范围。常用[0-9]表数字，[a-z]/[A-Z]表大小写的字母。
- 字符组可以使用脱字符^ 表示补集。`[^a-z]`括号里紧跟一个脱字符，表示只要不是小写字母都可以匹配成功。需要注意的是这种排除型字符组在当前位置必须匹配上一个字符，如果当前位置没有字符，会返回false。比如

```python
#python
re.search("[^0-9][0-9]","3") != None #返回false
re.search("[^0-9][0-9]","a3") != None #返回true
```

###### 元字符

前面用到的连接符-并不能匹配字面意义上的’-‘符号，而表示范围的含义。这类字符就是元字符。

| 元字符 | 含义                                         | 备注                          |
| ------ | -------------------------------------------- | ----------------------------- |
| \      | 将元字符变成普通字符、将普通字符变成特殊字符 | 特殊字符如\t制表符            |
| ^      | 规定匹配输入字符串开始的位置                 |                               |
| $      | 规定匹配输入字符串结束的位置                 |                               |
| *      | 零次或多次匹配前面的字符或子表达式           |                               |
| +      | 一次或多次匹配前面的字符或子表达式           |                               |
| ?      | 零次或一次匹配前面的字符或子表达式           | 还用于调整贪婪/非贪婪匹配模式 |
| {n}    | 表示前面的字符刚好匹配n次，n非负             |                               |
| {m,n}  | 表示前面的字符匹配m-n次，闭区间              |                               |
| .      | 匹配除"\r\n"之外的任何单个字符               |                               |

这个表格非常简陋，因为你不可能通过看这个表格学会正则...更多的细节去撸代码实践吧，至于这些繁琐的条例，想不起来找本工具书查查就行

###### 转义

在正则中特殊元字符的转义需要注意以下情况。如果想匹配{m,n}的字面意思，这里有两个元字符，分别是{和}，但是转义字符只需要也只能写一个，也就是

```
\{m,n} 匹配 "{m,n}"
```

类似的，还有

<img src="C:\Users\19956875375\AppData\Roaming\Typora\typora-user-images\image-20210920160754539.png" alt="image-20210920160754539" style="zoom:43%;" />

具体到编码上，还需要注意不同语言对转义符的解释不尽相同

```python
#python
re.search("[0\\-9]","3") != None #返回false，因为连接符-被转义成了字面意思
re.search("[0\\-9]","-") != None #返回True
#注意这里使用了两个转义字符，是因为python中的字符串自带一套转义规则，而我们使用正则时需要保证传入的转义符是字面含义，所以需要对转义符进行转义保证它是字面意思
#幸运的是，Python支持原生字符串完美解决这个问题
re.search(r"[0\-9]","-") != None #返回True, 原生字符串所见即所得
```

```java
//java
//在其他语言中，\\ 表示：我想要在正则表达式中插入一个普通的（字面上的）反斜杠，请不要给它任何特殊的意义。
//在 Java 中，\\ 表示：我要插入一个正则表达式的反斜线，所以其后的字符具有特殊的意义。
//在其他的语言中一个反斜杠 \ 就足以具有转义的作用，而在 Java 中正则表达式中则需要有两个反斜杠才能被解析为其他语言中的转义作用
//可以简单的理解在 Java 的正则表达式中，两个 \\ 代表其他语言中的一个 \
"-".matches("[0\-9]") //返回true
```

字符组还有个点是字符组的简记形式，比如\d可以代码[0-9]的含义。但是这些约定在不同语言下有细微差别，所以此处不罗列，如需要请自行探索。

#### 量词

在上面元字符的表格里，有四种元字符与数量相关，分别对应最常用的若干情况，称为正则语言中的量词。

需要注意这些量词，不仅可以修饰单个字符，比如`a{3}`表示匹配`"aaa"`，还可以修饰子表达式，也就是一个子正则表达式，比如`[0-9a-zA-Z_]{3,15}`这里的量词修饰一个字符组。

量词还有一种叫作优先量词，涉及正则匹配原理中的回溯，放到之后再说~

#### 附录

学习博客 https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md

古老的学习博客 https://i.linuxtoy.org/docs/guide/ch26.html

在线实操  https://ihateregex.io/playground

可视化正则 https://jex.im/regulex/

《正则指引》pdf https://www.cnblogs.com/hoyun/p/14171552.html

